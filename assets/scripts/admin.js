var symphony=window.symphony||{};symphony.editor={init:function(){var e=$(".admin--icon-external"),n=$("#urlAlias").val();e.attr("href","/"+siteUrlAlias+"/"+n),symphony.editor.resize()},resize:function(e){var n=$(".admin--preview-window-inner"),t=$(".admin--resize-toggle");t.on("click",function(e){var i=$(this).data("resolution");t.removeClass("active"),$(this).addClass("active"),n.removeClass("desktop tablet mobile").addClass(i)})}},symphony.editor.init(),symphony.admin={activeDocs:{},deletedDocs:{},activeContainer:$(".active"),expiredContainer:$(".expired"),body:$("body"),docType:"",activeView:"",currentUrl:URI(window.location.href)._parts.path,socialNetworks:["Facebook_Page_URL","Facebook_Like_URL","Twitter_Page_URL","Twitter_Like_URL","Instagram_Page_URL","Pinterest_Page_URL","Vine_Page_URL"],subscribedSites:[],init:function(){var e=this;e.loginTimer(),e.openMenu(),e.handlebarsHelpers(),e.highlightActive(),e.identifySiteSubscriptions(),e.registerEvents()},registerEvents:function(){var e=this;$(".admin--tree-page-summary").on("click",function(e){e.preventDefault()}),$(".admin--editor-sections").on("click","div:not(.is-header)",function(n){e.selectModule($(this))}),$(".admin--editor-sections>div.is-selected").length>0&&e.selectModule($(".admin--editor-sections>div.is-selected").eq(0))},selectModule:function(e){$(".admin--editor-sections>div").each(function(){$(this).removeClass("is-selected"),$("."+$(this).data("section")).hide()}),e.addClass("is-selected"),$("."+e.data("section")).show()},identifySiteSubscriptions:function(){var e=$.get("/"+siteUrlAlias+"/admin/site_subscriptions/all");e.done(function(e){symphony.admin.subscribedSites=JSON.parse(e)})},highlightActive:function(){$(".admin--navigation-item").each(function(){var e=URI($(this).find("a").attr("href"));e.equals(window.location.pathname+window.location.search)===!0&&$(this).addClass("active")})},adminHome:function(){var e=this.adminHome;symphony.admin.docType="document",e.refresh=function(){e.getActive(),e.getExpired(),symphony.admin.loadingIndicator("off")},e.getActive=function(){var n=$.get("/"+siteUrlAlias+"/admin/site_tree");n.done(function(n){e.populateActiveTemplate(n)})},e.getExpired=function(){var n=$.get("/"+siteUrlAlias+"/admin/recycle_bin/json?start=0&limit=25");n.done(function(n){e.populateExpiredTemplate(n)})},e.populateActiveTemplate=function(e){var n=[];symphony.admin.activeDocs=JSON.parse(e),n=_.remove(symphony.admin.activeDocs,function(e){return null==e.deletionDate}),symphony.admin.activeDocs=n,symphony.admin.activeContainer.empty().append(symphony.templates.docsActive({page:symphony.admin.activeDocs}))},e.populateExpiredTemplate=function(e){var n={};symphony.admin.deletedDocs=JSON.parse(e),n.objects=_.remove(symphony.admin.deletedDocs.objects,function(e){return null==e.startDate}),symphony.admin.deletedDocs.totalCount=n.objects.length,symphony.admin.deletedDocs.objects=n.objects,symphony.admin.expiredContainer.empty().append(symphony.templates.docsExpired({page:symphony.admin.deletedDocs}))},e.refresh()},eventsHome:function(){var e=this.eventsHome;symphony.admin.docType="events",e.refresh=function(){e.getEvents(),symphony.admin.loadingIndicator("off")},e.getEvents=function(){var n=$.get("/"+siteUrlAlias+"/admin/events/json?start=0&limit=250");n.done(function(n){symphony.admin.activeDocs=JSON.parse(n),e.getExpired()})},e.getExpired=function(){var n=moment().utcOffset(-6).format();symphony.admin.expiredDocs=_.filter(symphony.admin.activeDocs.objects,function(e){return null!==e.expiry&&null!==e.startDate&&e.expiry<n}),_.remove(symphony.admin.activeDocs.objects,function(e){return null!==e.expiry&&null!==e.startDate&&e.expiry<n}),symphony.admin.activeDocs.totalCount=symphony.admin.activeDocs.objects.length,e.populateActiveTemplate(),e.getDeleted()},e.getDeleted=function(){var n=$.get("/"+siteUrlAlias+"/admin/recycle_bin/json?start=0&limit=25");n.done(function(n){var t={},i=[];symphony.admin.deletedDocs=JSON.parse(n),t=_.remove(symphony.admin.deletedDocs.objects,function(e){return null!==e.startDate}),i.objects=_.concat(t,symphony.admin.expiredDocs),symphony.admin.deletedDocs.totalCount=i.objects.length,symphony.admin.deletedDocs.objects=i.objects,e.populateExpiredTemplate()})},e.populateActiveTemplate=function(){_.forEach(symphony.admin.activeDocs.objects,function(e,n){if(null!==e.customHeadContent){var t=JSON.parse(e.customHeadContent);e.customHeadContent=t}}),symphony.admin.activeContainer.empty().append(symphony.templates.eventsActive({event:symphony.admin.activeDocs}))},e.populateExpiredTemplate=function(){symphony.admin.expiredContainer.empty().append(symphony.templates.eventsExpired({events:symphony.admin.deletedDocs}))},e.refresh()},pressReleasesHome:function(){var e=this.pressReleasesHome;symphony.admin.docType="news",e.refresh=function(){e.getActive(),symphony.admin.loadingIndicator("off")},e.getActive=function(){var n=$.get("/"+siteUrlAlias+"/admin/news/json?page=1&start=0&limit=250");n.done(function(n){e.populateActiveTemplate(n)})},e.populateActiveTemplate=function(e){symphony.admin.activeDocs=JSON.parse(e),symphony.admin.activeContainer.empty().append(symphony.templates.pressActive({news:symphony.admin.activeDocs}))},e.refresh()},storiesHome:function(){var e=this.storiesHome;symphony.admin.docType="story",e.refresh=function(){e.getActive(),symphony.admin.loadingIndicator("off")},e.getActive=function(){var n=$.get("/"+siteUrlAlias+"/admin/story/json?page=1&start=0&limit=250");n.done(function(n){e.populateActiveTemplate(n)})},e.populateActiveTemplate=function(e){symphony.admin.activeDocs=JSON.parse(e),symphony.admin.activeContainer.empty().append(symphony.templates.storiesActive({story:symphony.admin.activeDocs}))},e.refresh()},captureActiveView:function(){var e=new RegExp("[?&amp;]view=([^#]*)").exec(window.location.href);e&&(symphony.admin.activeView=e[1])},propertiesView:function(){var e=this.propertiesView;e.catchChanges=function(){$("input, textarea").on("change keyup",function(){$(this).addClass("changed"),$(this).is(":invalid")?($(this).is("input[type=url]")&&$(this).next(".admin--error-text").removeClass("inactive"),$(".btn-save").addClass("inactive")):($(this).next(".admin--error-text").addClass("inactive"),$(".btn-save").removeClass("inactive"))})},e.showActiveView=function(){if(symphony.admin.captureActiveView(),""!==symphony.admin.activeView){var e=$('.collapsible[data-view="'+symphony.admin.activeView+'"]');e.addClass("opened"),symphony.admin.activeContainer=e.find($(".active")),"socialMedia"===symphony.admin.activeView&&(symphony.admin.activeContainer=$('.active[data-type="'+symphony.admin.activeView+'"]'),symphony.admin.activeView=symphony.admin.socialNetworks)}},e.getActive=function(){var n=$.get("/"+siteUrlAlias+"/admin/site_properties/symphonyserialize");n.done(function(n){symphony.admin.activeDocs=JSON.parse(n),e.checkMissing(),e.populateActiveTemplate(n)})},e.checkMissing=function(){""!==symphony.admin.activeView&&"string"==typeof symphony.admin.activeView?-1===_.findIndex(symphony.admin.activeDocs.objects,function(e){return e.name===symphony.admin.activeView})&&e.createMissing(symphony.admin.activeView):""!==symphony.admin.activeView&&"string"!=typeof symphony.admin.activeView&&_(symphony.admin.activeView).forEach(function(n){-1===_.findIndex(symphony.admin.activeDocs.objects,function(e){return e.name===n})&&e.createMissing(n)})},e.createMissing=function(n){var t=$.post("/"+siteUrlAlias+"/admin/site_properties/update",{id:"",name:n,value:" "});t.done(function(){e.getActive()})},e.populateActiveTemplate=function(){"object"==typeof symphony.admin.activeView?(_.remove(symphony.admin.activeDocs.objects,function(e){return _.indexOf(symphony.admin.activeView,e.name)<0}),symphony.admin.activeContainer.empty().append(symphony.templates.socialMedia({property:symphony.admin.activeDocs.objects}))):symphony.admin.activeContainer.empty().append(symphony.templates[symphony.admin.activeView]({property:symphony.admin.activeDocs.objects[_.findIndex(symphony.admin.activeDocs.objects,function(e){return e.name===symphony.admin.activeView})]})),e.catchChanges()},e.saveProperty=function(n){function t(){$.ajax({url:"/"+siteUrlAlias+"/admin/site_properties/update",data:{id:i[o].id,name:i[o].name,value:i[o].value,siteUrlAlias:siteUrlAlias},type:"POST",beforeSend:function(){symphony.admin.loadingIndicator("on",a)},error:function(e){},success:function(n){o++,o<i.length?t():(symphony.admin.loadingIndicator("off",a),e.getActive())}})}if(!$(n).hasClass("inactive")){var i=[],a=$(".opened .active"),o=0;$.each($(n).parent().parent().find(".changed"),function(){i.push({id:$(this).data("prop"),value:$(this).val(),name:$(this).data("name")})}),t()}},e.deleteAll=function(){_(symphony.admin.activeDocs.objects).forEach(function(e){$.ajax({url:"/"+siteUrlAlias+"/admin/site_properties/delete/"+e.id,method:"DELETE"})})},e.showActiveView(),e.getActive()},adminUI:function(){$("#title").on("change input paste keyup",_.throttle(symphony.symphony.admin.convertToSlug,500))},adminModal:function(e){$.magnificPopup.open({items:{src:"#"+e},type:"inline"})},addTitleModal:function(){$.magnificPopup.open({items:{src:"#newPage"},type:"inline"}),symphony.admin.createDocument()},createDocument:function(){$(".createPage").on("click",function(e){e.preventDefault();var n=$(this).parent().find("#docTitle").val();"story"===symphony.admin.docType?document.location.href="/"+siteUrlAlias+"/admin/story_create?storyTitle="+n:"events"===symphony.admin.docType?document.location.href="/"+siteUrlAlias+"/admin/events_create?eventsTitle="+n:document.location.href="/"+siteUrlAlias+"/admin/document_create?dTitle="+n})},collapsibleTrigger:function(e){$(e).parent().find(".collapsible").toggleClass("opened"),$(e).parent().next(".fa").toggleClass("fa-angle-down")},editDocument:function(e){"undefined"==typeof symphony.admin.docType&&(symphony.admin.docType="document"),window.location.href="/"+siteUrlAlias+"/admin/"+symphony.admin.docType+"_editor?documentId="+e},tempDelete:function(e){var n=$.ajax({url:"/"+siteUrlAlias+"/admin/document/"+e,type:"DELETE"});n.done(function(e){symphony.admin.successfulResponse(e)}),n.fail(function(e){symphony.admin.failedResponse(e)})},finalDelete:function(e){var n=$.ajax({url:"/"+siteUrlAlias+"/admin/recycle_bin/delete/"+e,type:"DELETE"});n.done(function(e){symphony.admin.successfulResponse(e)}),n.fail(function(e){symphony.admin.failedResponse(e)})},restoreDeleted:function(e){var n=$.ajax({url:"/"+siteUrlAlias+"/admin/recycle_bin/restore/"+e,type:"PUT"});n.done(function(){symphony.admin.successfulResponse()}),n.fail(function(e){symphony.admin.failedResponse(e)})},togglePublishStatus:function(e,n){$(e).hasClass("published")?$(e).removeClass("published").addClass("unpublished"):$(e).removeClass("unpublished").addClass("published");var t=$.ajax({url:"/"+siteUrlAlias+"/admin/document/publish/"+n,type:"POST"});t.done(function(){symphony.admin.successfulResponse()}),t.fail(function(e){symphony.admin.failedResponse(e)})},toggleFeaturedStatus:function(e,n){var t=$(e).find(".fa");t.hasClass("fa-star-o")?t.removeClass("fa-star-o").addClass("fa-star"):t.removeClass("fa-star").addClass("fa-star-o");var i=$.ajax({url:"/"+siteUrlAlias+"/admin/document/menudisplay/"+n,type:"POST"});i.done(function(){symphony.admin.successfulResponse()}),i.fail(function(e){symphony.admin.failedResponse(e)})},handlebarsHelpers:function(){Handlebars.registerHelper("readableDate",function(e){return e.deletionDate?"Deletion date: "+moment.utc(e.deletionDate).local().format("M/D/YYYY h:mm:ssA"):null!==e.lastUpdated&&null==e.startDate?"Last updated: "+moment.utc(e.lastUpdated).local().format("M/D/YYYY h:mm:ssA"):null!==e.expiry?"Expiration date: "+moment.utc(e.expiry).local().format("M/D/YYYY h:mm:ssA"):null!==e.startDate?"Start date: "+moment.utc(e.startDate).local().format("M/D/YYYY h:mm:ssA"):void 0}),Handlebars.registerHelper("removeUnderscores",function(e){return e.replace(/_/g," ")}),Handlebars.registerHelper("firstWord",function(e){return e.slice(0,e.indexOf("_")).toLowerCase()}),Handlebars.registerHelper("everyOther",function(e,n,t){return++e%n?t.inverse(this):t.fn(this)})},loadingIndicator:function(e,n){"undefined"==typeof n&&(n=symphony.admin.body),"off"===e?$(n).removeClass("loading"):$(n).addClass("loading")},successfulResponse:function(){symphony.admin.loadingIndicator("on"),"events"===symphony.admin.docType?_.delay(symphony.admin.eventsHome.refresh,1e3):"story"===symphony.admin.docType?_.delay(symphony.admin.storiesHome.refresh,1e3):_.delay(symphony.admin.adminHome.refresh,1e3)},failedResponse:function(e){console.log(e)},convertToSlug:function(){var e=$("#title").val(),n=e.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-");n.length<=255&&$("#urlAlias").val(n)},loginTimer:function(){var e=moment().toISOString(),n=moment(e).add(30,"minutes").toISOString(),t=Date.parse(n)-Date.parse(e),i=moment.duration(t,"milliseconds"),a=1e3;setInterval(function(){i=moment.duration(i-a,"milliseconds"),i.minutes()<=5&&(console.log(i._milliseconds),i._milliseconds<3e5&&i._milliseconds>=1e3?$(".admin--countdown").addClass("reveal").text("Warning! You will be logged out in "+i.minutes()+" minutes and "+i.seconds()+" seconds! Please refresh or save your changes to stay logged in."):i._milliseconds<=-1e3&&location.assign("/"+siteUrlAlias+"/admin"))},a)},openMenu:function(){function e(){t.addClass("expanded")}function n(){t.removeClass("expanded")}var t=$(".admin--navigation-items");t.hoverIntent(e,n)}};
//# sourceMappingURL=admin.js.map
